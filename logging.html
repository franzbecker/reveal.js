<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Logging</title>

		<meta name="description" content="Logging How-To">
		<meta name="author" content="Franz Becker">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

	</head>

	<body>

		<div class="reveal">

			<div class="slides">

<!-- Titel -->
				<section>
					<h1>Logging</h1>
				</section>

<!-- Motivation -->
				<section>
					<section>
						<h2>Warum überhaupt Logging?</h2>
						<ul>
							<li>Spart Zeit in der Entwicklung</li>
							<li>Fehlersuche im fertigen Produkt</li>
						</ul>
					</section>
					<section>
						<h3>Logging während der Entwicklung</h3>
						<br/>
						<p>
							<ul>
								<li>Spart Zeit beim Debugging</li>
								<li>Große Hilfe für nebenläufige Prozesse</li>
								<li>Gute Vorbereitung für Produktion</li>
							</ul>
						</p>
						<p>
							<br/>Um die Übersicht zu behalten helfen Tools wie Grep Console.
						</p>
					</section>
					<section>
						<h3>Logging in Produktion</h3>
						<br/>
						<p>
							<ul>
								<li>Beschleunigt die Fehlersuche</li>
								<li>Oft sogar die einzige Möglichkeit diese ausreichend
								zu verstehen um sie reproduzieren zu können</li>
							</ul>
						</p>
					</section>
				</section>

<!-- SLF4J / Log4J -->
				<section>
					<section>
						<h2>Logging Frameworks</h2>
						<p>Es gibt verschiedene Logging Frameworks, diese kann man entweder direkt verwenden
						oder gegen eine allgemeine API programmieren wie beispielsweise SLF4J.</p>
					</section>
					<section>
						<p>Log4j 2</p>
						<pre><code data-trim contenteditable>
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

Logger logger = LogManager.getLogger(MyClass.class);
						</code></pre>
<br/>
						<p>SLF4J<br/><small>Simple Logging Facade for Java</small></p>
						<pre><code data-trim contenteditable>
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

Logger logger = LoggerFactory.getLogger(MyClass.class);
						</code></pre>
					</section>
					<section>
						  <p>SLF4J</p>
						  <small>
							  Sucht im Classpath nach der Klasse: <code>org.slf4j.impl.StaticLoggerBinder</code>
							  <br/>
							  Wenn diese nicht gefunden wird erhält man folgende Meldung:
						  </small>
						  <pre><code data-trim contenteditable>
SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
						  </pre></code>
					</section>
				</section>

<!-- LOGGER -->
				<section>
					<section>
						<h2>LOGGER</h2>
					</section>
					<section>
						<h3>DON'T</h3>
						<p>Uppercase LOGGER Variable</p>
						<br/>
						<pre><code data-trim contenteditable>
private static final LOGGER =
    LoggerFactory.getLogger(MyClass.class);

LOGGER.info("Hello, world");
						</pre></code>
						<br/>
						Der Logger ist <strong>keine</strong> Konstante.
					</section>
					<section>
						<h3>DO</h3>
						<pre><code data-trim contenteditable>
private static final logger =
    LoggerFactory.getLogger(MyClass.class);

logger.info("Hello, world");
						</pre></code>
					</section>
				</section>
<!-- copy & paste -->
				<section>
					<section>
						<h2>copy & paste</h2>
					</section>
					<section>
						<h3>DON'T</h3>
						<p>Copy & paste is evil&trade;</p>
						<br/>
						<pre><code data-trim contenteditable>
public class MyClass {

    private static final Logger logger =
		LoggerFactory.getLogger(OtherClass.class);

}
						</pre></code>
						<br/>
							<ul>
								<li>Abhängigkeit auf fremde Klasse</li>
								<li>Verwirrende Log-Ausgaben</li>
								<li>Copy & paste ist zu viel Arbeit - ineffizient</li>
							</ul>
						</p>
					</section>
					<section>
						<h3>DO</h3>
						<p>Eclipse Template</p>
						<br/>
						<pre><code data-trim contenteditable>
${:import(org.slf4j.Logger, org.slf4j.LoggerFactory)}
private static final Logger logger =
    LoggerFactory.getLogger(${enclosing_type}.class);
						</pre></code>
					</section>
				</section>

<!-- fragmentieren -->
				<section>
					<section>
						<h2>fragmentieren</h2>
					</section>
					<section>
						<h3>DON'T</h3>
						<p>Mehrere Logeinträge für dasselbe Ereignis</p>
						<br/>
						<pre><code data-trim contenteditable>
logger.info("Something interesting is happening");
logger.info("right here!");
						</pre></code>
						<pre class="fragment"><code data-trim contenteditable>
logger.error("I got a problem, here is my information:");
for (String entry : list) {
    logger.error(entry);
}
						</pre></code>
						<br>
						<ul class="fragment">
							<li>Erschwert das manuelle Analysieren von Logs</li>
							<li>Verhindert das automatisierte Analysieren von Logs</li>
							<li>Log ist fragmentiert im Multi-User / Multi-Thread Szenario</li>
						</ul>
					</section>
					<section>
						<h3>DO</h3>
						<p>Ein Logeintrag pro Ereignis</p>
						<br/>
						<pre><code data-trim contenteditable>
import com.google.common.base.Joiner;
import static java.lang.System.lineSeparator;


String info = Joiner.on(lineSeparator()).join(list);
logger.error("I got a problem, here is my information: \n{}", info);
						</pre></code>
					</section>
				</section>

<!-- Konkatenation -->
				<section>
					<section>
						<h2>Konkatenation</h2>
					</section>
					<section>
						<h3>DON'T</h3>
						<p>Nicht-literale Strings konkatenieren</p>
						<br>
						<pre><code data-trim contenteditable>
logger.trace("Request with id " + request.getId() + " was"
  + " successful and the data was: " + request.getData());
						</code></pre>
						<br>
						<ul>
							<li>String wird unabhängig vom Log-Level gebaut</li>
							<li>Schwierig zu lesen / zu schreiben</li>
						</ul>
					</section>
					<section>
						<h3>DON'T</h3>
						<p>Log-Level für <strong>triviale</strong> Statements abfragen</p>
						<br>
						<pre><code data-trim contenteditable>
if (logger.isTraceEnabled()) {
  logger.trace("Request with id " + request.getId() + " was "
    + " successful and the data was: " + request.getData());
}
						</code></pre>
						<br>
						<ul>
							<li>Code wird unübersichtlich</li>
							<li>Log-Level muss an zwei Stellen geändert werden</li>
						</ul>
						</p>
					</section>
					<section>
						<h3>DO</h3>
						<p>Parameterized Logging</p>
						<br/>
						<pre><code data-trim contenteditable>
logger.trace("Request with id {} was successful and the data " +
  "was: {}", request.getId(), request.getData());
						</pre></code>
					</section>
				</section>

<!-- Set Error Level Manually -->
<section>
	<section>
		<h2>Log-Level setzen</h2>
	</section>
	<section>
		<h3>DON'T</h3>
		<p>Log-Level im Code setzen</p>
		<br>
		<pre><code data-trim contenteditable>
LOGGER.setLevel(Level.ERROR);
		</code></pre>
		<pre class="fragment"><code data-trim contenteditable>
Level oldLevel = LOGGER.getLevel();
LOGGER.setLevel(Level.TRACE);

// here be dragons

LOGGER.setLevel(oldLevel);
		</code></pre>
		<br>
		<ul class="fragment">
			<li>Log-Level wird konfiguriert</li>
			<li>In Log4J 2 und SLF4J gibt es dafür keine API!</li>
		</ul>
	</section>
</section>

<!-- Vererbung -->
<section>
	<section>
		<h2>Logger Vererbung</h2>
	</section>
	<section>
		<h3>SOMETIMES</h3>
		<p>Logger Vererbung kann sinnvoll sein</p>
		<br>
		<pre><code data-trim contenteditable>
abstract public class AbstractBaseClass {

    protected final Logger logger =
	    LoggerFactory.getLogger(getClass());

    protected void initialize() {
        // ...
        logger.trace("Initialization completed.")
    }

}
		</code></pre>
		<br>
		<ul>
			<li>Kann hilfreich sein aber auch verwirren</li>
			<li>Caller im Log-Pattern ist sehr teuer</li>
		</ul>
	</section>
</section>

<!-- MDC -->
<section>
	<section>
		<h2>MDC</h2>
	</section>
	<section>
		<h3>MDC</h3>
		<p>Mapped Diagnostic Context</p>
		<br>
		<ul>
			<li>Thread-lokale Map mit Kontextinformation</li>
			<li>Framework kann MDC in die Ausgabe einbauen</li>
		</ul>
	</section>
	<section>
		<h3>DON't</h3>
		<p>Parameter in API nur für Logging</p>
		<br>
		<pre><code data-trim contenteditable>
public BigDecimal calculateSum(List&lt;Item&gt; items, String orderId) {
    BigDecimal sum = BigDecimal.ZERO;
    for (Item item : items) {
        sum.add(item.getPrice());
    }
    logger.debug("Calculated total price of {} for orderId: {}",
        sum, orderId);
}
		</code></pre>
    </section>
	<section>
		<h3>DO</h3>
		<br>
		<pre><code data-trim contenteditable>
public static final String ORDER_ID = "orderId"; // MDC helper

public void handleOrder(Order order) {
    MDC.put(ORDER_ID, order.getId());
    // ... call calculateSum somewhere
    MDC.clear();
}
</code></pre>
<pre><code data-trim contenteditable>
  &lt;PatternLayout pattern="... %X{orderId} ..." />
</code></pre>
<pre class="fragment"><code data-trim contenteditable>
public BigDecimal calculateSum(List&lt;Item&gt; items) {
    BigDecimal sum = BigDecimal.ZERO;
    for (Item item : items) {
        sum.add(item.getPrice());
    }
    logger.debug("Calculated total price of {}", sum);
}
		</code></pre>

    </section>
</section>

<section>
	<h2>happy logging</h2>
</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
